@{
    ViewBag.Title = "Costs";
}

<h2>@ViewBag.Title</h2>

<a class="btn btn-default" href="/Costs/Create" role="button">
    <span class="glyphicon glyphicon-plus"></span> Add
</a>

<table id="tableCostConfigurations" class="table table-striped" width="100%">
    <thead></thead>
    <tfoot class="filter">
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
    </tfoot>
    <tbody></tbody>
</table>

@section Scripts {
    <script>
        $(document).on('ready', function () {
            getCostConfigurations();
        })

        function getCostConfigurations() {
            $.get('/api/Rest/GetCostConfigurations', null, function (data) {
                var table = $('#tableCostConfigurations').DataTable({
                    "dom": "<'row'<'col-md-12'f>><'row'<'col-md-6'i><'col-md-6'p>><'row'<'col-md-12'tr>><'row'<'col-md-6'l><'col-md-6'p>>",
                    "destroy": true,
                    "data": data,
                    "order": [[0, 'asc']],
                    "rowId": "Id",
                    "columns": [
                    {
                        "title": "Name",
                        "render": function (data, type, row) {
                            return '<a href="/Costs/Edit/' + row.Id + '">' + row.Name + '</a>';
                        }
                    },
                    {
                        "title": "Year",
                        "data": "Year",
                    },
                    {
                        "title": "Month",
                        "data": "Month",
                        "render": function (data, type, row) {
                            switch (data)
                            {
                                case 1:
                                    return 'January';
                                case 2:
                                    return 'February';
                                case 3:
                                    return 'March';
                                case 4:
                                    return 'April';
                                case 5:
                                    return 'May';
                                case 6:
                                    return 'June';
                                case 7:
                                    return 'July';
                                case 8:
                                    return 'August';
                                case 9:
                                    return 'September';
                                case 10:
                                    return 'October';
                                case 11:
                                    return 'November';
                                case 12:
                                    return 'December';
                            }

                            return '';
                        }
                    },
                    {
                        "title": "Planned Hours",
                        "data": "PlannedHours",
                    },
                    {
                        "defaultContent": '<a class="del" href="#"><span class="glyphicon glyphicon-remove"></span></a>',
                        "orderable": false
                    }]
                });

                $('#tableCostConfigurations tfoot th').each(function () {
                    var title = $('#tableCostConfigurations thead th').eq($(this).index()).text();
                    if (title.length > 0) {
                        $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '">');
                    }
                });

                table.columns().eq(0).each(function (colIdx) {
                    $('input', table.column(colIdx).footer()).on('keyup change', function () {
                        table.column(colIdx).search(this.value).draw();
                    });
                });
            });
        }

        $('#tableCostConfigurations').on('click', 'a.del', function () {
            if (confirm('Are you sure?') === true) {
                var table = $('#tableCostConfigurations').DataTable();

                $.post('/api/Rest/DeleteCostConfiguration/' + table.row($(this).parents('tr')).data().Id, null, function () {
                    $.notify({ message: 'Data Deleted.' }, { type: 'success', placement: { from: 'top', align: 'center' } });
                    getCostConfigurations();
                });
            }
        })
    </script>
}