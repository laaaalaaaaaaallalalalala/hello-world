@{
    ViewBag.Title = "Account";
}

<h2>@ViewBag.Title</h2>

<hr />

<form id="formAccount" class="form-horizontal">
    <div class="form-group">
        @Html.Label("Name", "Name", new { @class = "col-md-2 control-label" })
        <div class="col-md-10">
            @Html.TextBox("Name", "", new { @class = "form-control" })
        </div>
    </div>
    <div class="form-group">
        @Html.Label("Code", "Code", new { @class = "col-md-2 control-label" })
        <div class="col-md-10">
            @Html.TextBox("Code", "", new { @class = "form-control" })
        </div>
    </div>
    <div class="form-group">
        @Html.Label("Description", "Description", new { @class = "col-md-2 control-label" })
        <div class="col-md-10">
            @Html.TextArea("Description", "", new { @class = "form-control" })
        </div>
    </div>
    <div class="form-group">
        @Html.Label("LogoUploader", "Logo", new { @class = "col-md-2 control-label" })
        <div class="col-md-10">
            <input id="LogoUploader" name="LogoUploader" type="file" class="file-loading">
            <div id="LogoErrors"></div>
        </div>
        @Html.Hidden("Logo")
    </div>
    <div class="form-group">
        <div class="col-md-12 text-right">
            <button class="btn btn-primary" type="submit">Save</button>
        </div>
    </div>
</form>

@section Scripts {
    <script>
        $(document).on('ready', function () {
            $("#formAccount #LogoUploader").fileinput({
                showClose: false,
                showCaption: false,
                elErrorContainer: '#formAccount #LogoErrors',
                defaultPreviewContent: '<img src="/Images/no-image.png" alt="Please choose logo." style="height: 64px">',
                layoutTemplates: { main2: '{preview} {remove} {browse}' },
                allowedFileExtensions: ["jpg", "png", "gif"],
                uploadUrl: '/Accounts/UploadLogo',
            })

            $('#formAccount').bootstrapValidator({
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    Logo: { validators: {} },
                    Name: { validators: { notEmpty: { message: 'Please provide name.' } } },
                    Code: { validators: {} },
                    Description: { validators: {} },
                }
            }).on('success.form.bv', function (e) {
                e.preventDefault()

                $.ajax({ url: '/api/Rest/AddAccount', type: 'POST', data: $('#formAccount').serialize(), }).done(function (data) {
                    $.notify({ message: 'Data Saved.' }, { type: 'success', placement: { from: 'top', align: 'center' } })
                    window.location = '/Accounts/Edit/' + data.Id
                })
            })
        })

        $('#formAccount #LogoUploader').on('fileuploaded', function (event, data, previewId, index) {
            $('#formAccount #Logo').val(data.response.path)
        }).on('fileclear', function (event) {
            $('#formAccount #Logo').val('')
        })
    </script>
}